ARG NODE_VERSION=8.11.3
FROM node:${NODE_VERSION}-alpine

########################################################################################################################
# INIT #################################################################################################################

LABEL maintainer="Jo√£o Silva <joaofasilva@outlook.com>"

RUN apk update && apk upgrade

# ######################################################################################################################
# Tweaks ###############################################################################################################

RUN rm -rf /tmp/* \
	&& rm -rf /var/cache/apk/* \
	&& rm -rf tmp/*

# ######################################################################################################################
# SOURCE_CODE ##########################################################################################################

WORKDIR /code

# ######################################################################################################################
# FILES OWNERSHIP ######################################################################################################

# Workaround for Linux develop environments -----------------------
ARG GROUP_USER_ID=0
ARG USER_ID=0
ARG USER_NAME=root
# Only run if the provided USER_ID arg is different of 0 (root)
RUN getent passwd "${USER_ID}"; \
    resultCode=$?; \
    if [ [ "${USER_ID}" != "0" ] && [ ${resultCode} -eq 0 ] ]; then \
        set -xe \
        && addgroup -g ${GROUP_USER_ID} -S ${USER_NAME} \
        && adduser -u ${USER_ID} -D -S -G ${USER_NAME} ${USER_NAME} \
        && mkdir -p /home/${USER_NAME} \
        && chmod -R 777 /home/${USER_NAME} \
        && chown -R ${USER_ID}:${GROUP_USER_ID} /home/${USER_NAME} \
	; fi
# -----------------------------------------------------------------
